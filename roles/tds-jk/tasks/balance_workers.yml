- lineinfile:
    dest: "{{ hostvars[instance.1.proxy].mod_jk_conf_path }}/mod_jk.workers"
    state: present
    line: 'worker.COLLECTION_{{ item | replace("/", "-") }}.balance_workers={{ worker_name }}'
  delegate_to: "{{ instance.1.proxy }}"
  vars:
    ansible_become: "{{ hostvars[instance.1.proxy].ansible_become | default(False) }}" # depends on how httpd was installed
    worker_name: "{{ instance.0.tds_debug is not defined | ternary([ansible_hostname, instance.1.properties.port]|to_uuid, [ansible_hostname, instance.1.properties.port]|join('_')) }}"
  with_items: "{{ instance.1.collections }}"
  when: 
    - instance.1.proxy is defined
    - instance.1.properties.protocol.lower().startswith("ajp")
