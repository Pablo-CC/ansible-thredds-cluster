- name: Copy web.xml
  copy:
    src: web.xml
    dest: "{{ tomcat_instances_path }}/{{ instance.name }}/conf/web.xml"
  with_first_found:
    - "{{ playbook_dir }}/{{ instance.files.web }}"
    - "{{ role_path }}/files/web.xml"

- name: Clone TAP subversion repository
  local_action: subversion repo=https://meteo.unican.es/svn/repos/meteo/software/tap dest=/tmp/tap/
  run_once: True

- name: Build TAP
  local_action: command mvn package chdir="/tmp/tap"
  run_once: True

- name: Copy udg-tap.war in TAP instances
  copy:
    src: /tmp/tap/target/udg-tap.war
    dest: "{{ tomcat_instances_path }}/{{ instance.name }}/webapps/udg-tap.war"