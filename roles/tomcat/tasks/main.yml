---
- name: Create directories for tomcat
  file:
    dest: "{{ item }}"
    state: directory
  with_items:
    - "{{ tomcat_home }}"
    - "{{ jre_install_base }}"

- name: Download dependencies
  run_once: True
  local_action: get_url
  args:
    url: "{{ item.url }}"
    dest: "/tmp/{{ item.filename }}"
    headers: "{{ item.header }}"
  vars:
    ansible_become: False
  with_items:
    - { url: "{{ jre_download_url }}", filename: "{{ jre_filename }}", header: "{{ jre_header }}" }
    - { url: "{{ tomcat_download_url }}", filename: "{{ tomcat_filename }}", header: "" }

- name: Unarchive file in remote host
  unarchive:
    src: "/tmp/{{ item.filename }}"
    dest: "{{ item.dest }}"
    extra_opts:
      --strip-components=1
  with_items:
    - { filename: "{{ tomcat_filename }}", dest: "{{ tomcat_home }}" }
    - { filename: "{{ jre_filename }}", dest: "{{ jre_install_base }}" }

- name: Create tomcat_base
  file: 
    dest: "{{ tomcat_base }}"
    state: directory

- name: Delete unnecessary stuff
  file:
    state: absent
    path: "{{ tomcat_home }}/{{ item }}"
  with_items: "{{ tomcat_to_be_removed }}"
