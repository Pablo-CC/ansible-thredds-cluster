# These facts are required by the backend to reference their proxies
- set_fact:
      mod_jk_hostname: "{{ ansible_nodename }}" # hostname
      mod_jk_conf_path: "{{ mod_jk_conf_path }}"
  tags: always

- include_tasks: "install_mod_jk.yml"
  tags: [install,jk]

- name: Create mod_jk_conf_path if not exists
  file: path={{ mod_jk_conf_path }} state=directory

- name: Reference mod_jk files from httpd.conf
  lineinfile:
    path: "{{ httpd_conf_file | default('/etc/httpd/conf/httpd.conf') }}"
    line: Include {{ mod_jk_conf_path }}/*.conf
  
- name: Template mod_jk.conf
  template:
    src: mod_jk.conf.j2
    dest: "{{ mod_jk_conf_path }}/mod_jk.conf"

- name: Template mod_jk.workers
  template:
    src: mod_jk.workers.j2
    dest: "{{ mod_jk_conf_path }}/mod_jk.workers"

- name: Template mod_jk.urimaps
  template:
    src: mod_jk.urimaps.j2
    dest: "{{ mod_jk_conf_path }}/mod_jk.urimaps"
  
- name: Create password for proxy status web pages
  htpasswd:
    path: "{{ mod_jk_status_path }}/.htpasswd"
    username: "{{ mod_jk_status_user }}"
    password: "{{ mod_jk_status_passwd }}"
  when:  mod_jk_status_user is defined 

