- name: Download virtualenv package
  local_action: get_url
  args:
    dest: "{{ downloads_tmp }}"
    url: "{{ venv_file_url }}"
  vars:
    ansible_become: False
  run_once: True

- name: Create vitualenv directories
  file:
    dest: "{{ item }}"
    state: directory
  with_items:
    - "{{ venv_home }}"
    - "{{ venv_sw }}"
    
- name: Unarchive virtualenv
  unarchive: 
    src: "{{ downloads_tmp }}/{{ venv_file_name }}"
    dest: "{{ venv_sw }}"

- name: Check if virtualenv is already created
  stat:
    path: "{{ venv_home }}/bin/activate"
  register: var_virtualenv_exists

- name: Create virtualenv if it has not been created before
  command: "python virtualenv.py {{ venv_home }}"
  args:
    chdir: "{{ venv_sw }}/virtualenv-{{ venv_version }}"
  when: var_virtualenv_exists.stat.exists == false

- name: Install supervisor in virtualenv
  pip:
    name: supervisor
    executable: "{{ venv_home }}/bin/pip"
