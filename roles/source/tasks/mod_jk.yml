- name: Include mod_jk vars
  include_vars: file="{{ role_path }}/defaults/mod_jk.yml"
  tags: always

- name: Install development packages
  become: True
  yum: state=present name="@Development tools"

- name: Install httpd-devel
  become: True
  yum: state=present name=httpd-devel

- name: Download mod_jk
  become: False
  run_once: True
  local_action: get_url
  args:
    url: "{{ mod_jk_download_url }}"
    dest: "{{ downloads_tmp }}/{{ mod_jk_filename }}"

- name: Create mod_jk_src directory
  file: path="{{ mod_jk_src }}" state=directory
  
- name: Unarchive mod_jk
  unarchive:
    src: "{{ downloads_tmp }}/{{ mod_jk_filename }}"
    dest: "{{ mod_jk_src }}"

- name: Configure and install mod_jk
  command: "{{ item }}"
  args:
    chdir: "{{ mod_jk_src }}/{{ mod_jk_filename_unarchive }}/native"
  with_items:
    - ./configure {{ mod_jk_configure | default("--with-apxs=/usr/sbin/apxs") }}
    - /usr/bin/make
    - /usr/bin/make install
