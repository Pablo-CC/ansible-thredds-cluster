
- name: Set new facts backend servers need
  set_fact:
    vip: "{{ ansible_eth1.ipv4.address }}"
    bind_port: "{{ bind_port }}"
    ipvs_rulefile_path: "{{ ipvs_rulefile_path }}"
    ansible_become: "{{ ansible_become | default(True) }}"

- name: Template LVS configure script for load-balancer
  become: False
  local_action:
    module: template
    src: lvs_script.sh.j2
    dest: files/lvs_script.sh
    mode: 0744

- name: Make sure ipvsadm.rules exists
  file:
    path: "{{ ipvs_rulefile_path }}"
    state: touch

- name: Execute script
  script: files/lvs_script.sh
