---
- name: Download dependencies
  run_once: True
  local_action: get_url
  args:
    url: "{{ item.url }}"
    dest: "/tmp/{{ item.filename }}"
    headers: "{{ item.header }}"
  with_items:
    - { url: "{{ derby_db_download_url }}", filename: "{{ derby_db_filename }}", header: "" }

- name: Unarchive file in remote host
  unarchive:
    src: "/tmp/{{ item.filename }}"
    dest: "{{ item.dest }}"
    extra_opts:
      --strip-components=1
  with_items:
    - { filename: "{{ derby_db_filename }}", dest: "{{ tomcat_catalina_home }}" }

- include: deploy_tomcat_instances.yml

- include_tasks: deploy_GWS.yml

- include: publish_catalogs.yml
  when: data is defined

#- name: Create directory for tds facts
  #file:
    #path: "{{ deployment.tds_facts }}"
    #state: directory

#- name: Register facts for tds
  #template:
    #src: tds.fact.j2
    #dest: "{{ deployment.tds_facts }}/tds.fact"
