- name: Copy catalogs
  synchronize:
    src: "{{ item.src }}/"
    dest: "{{ tomcat_catalina_home }}/content/thredds/gws/{{ item.gws }}/"
    archive: False
    recursive: True
  with_items: "{{ data.catalogs }}"
  tags: update_catalogs
  notify: restart tomcat_instance

# This task could be done above with --owner, but rsync does not support it until version 3.1
- name: Set owner of every catalog in the gws
  #become: True
  file: 
    path: "{{ tomcat_catalina_home }}/content/thredds/gws/{{ item.gws }}"
    #owner: "{{ item.owner }}"
    recurse: True
    state: directory
  with_items: "{{ data.catalogs }}"
  when: item.owner is defined

- name: Copy datasets 
  synchronize:
    src: "{{ item.src }}/"
    dest: "{{ tomcat_catalina_home }}/content/thredds/public/{{ item.dest | default('') }}/"
    archive: False
    recursive: True
  with_items: "{{ data.datasets }}"
  tags: update_catalogs
  notify: restart tomcat_instance

# This task could be done above with --owner, but rsync does not support it until version 3.1
#- name: Set owner of every dateset
  #become: True
  #shell: "chown -R {{ item.owner }}: {{ tomcat_catalina_home }}/content/thredds/public/*"
  #with_items: "{{ data.datasets }}"
  #when: item.owner is defined

