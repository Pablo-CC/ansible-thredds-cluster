---
# tasks file for haproxy_pablo
#
- name: Set variables for backend servers
  set_fact:
    haproxy_from_sources: False
    haproxy_conf_file: "{{ haproxy_conf_file }}"
    default_backend: "{{ default_backend }}"
    default_frontend: "{{ default_frontend }}"

- name: Setting ansible_become if not using containers
  set_fact:
    ansible_become: True
  when: (using_containers is not defined) or (using_containers == False)

- name: Install HAProxy
  yum:
    name: haproxy
    state: present

- name: Create stats socket directory
  file: 
    path: /run/haproxy
    state: directory

- name: Copy error files
  copy:
    src: errors
    dest: /etc/haproxy

- name: Copy HAProxy's configuration file
  template: 
    src: haproxy.cfg.j2
    dest: "{{ haproxy_conf_file }}"

