- name: Download tds
  run_once: True
  local_action: get_url
  args:
    url: "{{ tds_download_url }}"
    dest: "{{ tds_downloads_tmp}}/{{ tds_filename }}"
  vars:
    ansible_become: False

#- name: Remove existing TDS webapp
#  file: state=absent path={{ tomcat_base }}/{{ item.name }}/webapps/thredds/
#  with_items: "{{ tomcats }}"
#
#- name: Remove existing TDS content directory 
#  file: state=absent path={{ tomcat_base }}/{{ item.name }}/content
#  with_items: "{{ tomcats }}"

- name: Create TDS webapp path
  file: state=directory path={{ tomcat_base }}/{{ item.name }}/webapps/thredds
  with_items: "{{ tomcats }}"

- name: Unarchive tds in webapps/thredds
  unarchive: src={{ tds_downloads_tmp }}/{{ tds_filename }} dest={{ tomcat_base }}/{{ item.name }}/webapps/thredds
  with_items: "{{ tomcats }}"

- name: Create content/thredds/public/ in catalina home
  file: path={{ tomcat_home }}/content/thredds/public state=directory mode=g+rwx

- name: Create content/thredds/ directories in catalina base
  file: path="{{ tomcat_base}}/{{ item.name }}/content/thredds" state=directory
  with_items: "{{ tomcats }}"

- name: Link catalina base content/thredds/public to catalina home
  file: 
    path: "{{ tomcat_base }}/{{ item.name }}/content/thredds/public" 
    src: "{{ tomcat_home }}/content/thredds/public" 
    state: link
  with_items: "{{ tomcats }}"
