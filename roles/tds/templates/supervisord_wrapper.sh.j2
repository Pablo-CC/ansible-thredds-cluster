#!/bin/bash

function shutdown()
{
    date
    echo "Shutting down Tomcat"
    #unset CATALINA_PID # Necessary in some cases
    #unset LD_LIBRARY_PATH # Necessary in some cases
    #unset JAVA_OPTS # Necessary in some cases

    . $CATALINA_HOME/bin/catalina.sh stop
}

source catalina_vars

{% if item.tds_debug is defined %}
JPDA_ADDRESS={{ item.tds_debug.jpda_address | default('localhost:8000') }}
. $CATALINA_HOME/bin/catalina.sh jpda start
{% else %}
. $CATALINA_HOME/bin/catalina.sh start
{% endif %}


# Allow any signal which would kill a process to stop Tomcat
trap shutdown HUP INT QUIT ABRT KILL ALRM TERM TSTP

echo "Waiting for `cat $CATALINA_PID`"
wait `cat $CATALINA_PID`
