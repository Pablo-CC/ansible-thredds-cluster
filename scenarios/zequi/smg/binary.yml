- hosts: proxies
  become: True # requires ansible_become false in inventory for localhost
  vars:
    venv_home: "{{ ansible_env.HOME }}/virtualenv-httpd"
    httpd_source: False
    mod_jk_configure: --with-apxs=/usr/sbin/apxs
    mod_jk_conf_dir: "/etc/httpd/conf.d" # Mandatory
    mod_jk_shm: "/etc/httpd/logs/mod_jk.shm" # Mandatory
    mod_jk_log: "/etc/httpd/logs/mod_jk.log" # Mandatory
    httpd_conf: "{{ httpd_server_root }}/conf/httpd.conf" # Mandatory
  vars_files:
    - secret.yml
    - simpleDeployment.yaml
  roles:
    - role: supervisord-virtualenv
    - role: httpd
    - role: tds-gateway

- hosts: slaves
  become: True # requires ansible_become false in inventory for localhost
  vars:
    miniconda_python: 2
    miniconda_prefix: "{{ tomcat_catalina_home }}/miniconda2"
    miniconda_env:
      name: udg
      dependencies:
        - libnetcdf=4.4.1
        - supervisor=3.1.3
  vars_files:
    - secret.yml
    - simpleDeployment.yaml
    - catalogs.yaml
  roles:
    - role: ansible-miniconda-role
    - role: supervisord-conda
      venv_home: "{{ miniconda_prefix }}/envs/{{ miniconda_env.name }}"
    - role: tomcat
      venv_home: "{{ miniconda_prefix }}/envs/{{ miniconda_env.name }}"
