- hosts: proxies
  vars:
    venv_home: "{{ httpd_server_root }}/virtualenv"
    mod_jk_configure: --prefix={{ httpd_server_root }}/modules --with-apxs={{ httpd_server_root }}/bin/apxs
    mod_jk_conf_dir: "{{ httpd_server_root }}/conf.d" # Mandatory
    mod_jk_shm: "{{ httpd_server_root }}/logs/mod_jk.shm" # Mandatory
    mod_jk_log: "{{ httpd_server_root }}/logs/mod_jk.log" # Mandatory
    httpd_conf: "{{ httpd_server_root }}/conf/httpd.conf" # Mandatory
  vars_files:
    - simpleDeployment.yaml
    - secret.yml
  roles:
    - role: supervisord-virtualenv
    - role: httpd
    - role: tds-gateway

- hosts: slaves
  vars:
    miniconda_python: 2
    miniconda_prefix: "{{ tomcat_catalina_home }}/miniconda2"
    miniconda_env:
      name: udg
      dependencies:
        - libnetcdf=4.4.1
        - supervisor=3.1.3
  vars_files:
    - secret.yml
    - simpleDeployment.yaml
    - catalogs.yaml
  roles:
    - role: ansible-miniconda-role
    - role: supervisord-conda
      venv_home: "{{ miniconda_prefix }}/envs/{{ miniconda_env.name }}"
    - role: tomcat
      venv_home: "{{ miniconda_prefix }}/envs/{{ miniconda_env.name }}"
