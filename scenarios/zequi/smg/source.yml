- hosts: proxies
  vars:
    venv_home: "{{ httpd_server_root }}/virtualenv"
    mod_jk_configure: --prefix={{ httpd_server_root }}/modules --with-apxs={{ httpd_server_root }}/bin/apxs
    mod_jk_conf_dir: "{{ httpd_server_root }}/conf.d" # Mandatory
    mod_jk_shm: "{{ httpd_server_root }}/logs/mod_jk.shm" # Mandatory
    mod_jk_log: "{{ httpd_server_root }}/logs/mod_jk.log" # Mandatory
    httpd_conf: "{{ httpd_server_root }}/conf/httpd.conf" # Mandatory
  vars_files:
    - deployment-tap.yaml
    - secret.yml
  roles:
    - role: supervisord-virtualenv
    - role: httpd
    - role: tds-gateway

- hosts: backend
  vars:
    miniconda_python: 2
    miniconda_prefix: "{{ tomcat_catalina_home }}/miniconda2"
    miniconda_env:
      name: udg
      dependencies:
        - libnetcdf=4.4.1
        - supervisor=3.1.3

    derby_db_download_url: "http://archive.apache.org/dist/db/derby/db-derby-10.12.1.1/db-derby-10.12.1.1-lib.tar.gz"
    derby_db_filename: db-derby-10.12.1.1-lib.tar.gz
    venv_home: "{{ miniconda_prefix }}/envs/{{ miniconda_env.name }}"
  vars_files:
    - secret.yml
    - deployment-tap.yaml
  roles:
    - role: supervisord-conda
    - role: tds
    - role: tap

  tasks:
    - include_tasks: derby-authentication.yml
      tags: hola
