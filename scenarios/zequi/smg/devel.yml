- hosts: proxies
  vars:
    venv_home: "{{ httpd_server_root }}/virtualenv"
    httpd_server_root: "{{ ansible_env.HOME }}/httpd"
    httpd_server_www: "{{ httpd_server_root }}"
    httpd_document_root: "{{ httpd_server_root }}/htdocs"
    httpd_become_enabled: False
    httpd_source: True
    httpd_confd: "{{ httpd_server_root }}/conf.d"
    httpd_src: "{{ httpd_server_root }}/src"
    httpd_logs: "{{ httpd_server_root }}/logs"
    mod_jk_install_base: "{{ httpd_server_root }}/modules"
    jk_configure: --prefix={{ mod_jk_install_base }} --with-apxs={{ httpd_server_root }}/bin/apxs
  vars_files:
    - secret.yml
    - develDeployment.yaml
  roles:
    - role: supervisord-virtualenv
      
    - role: httpd
      httpd_conf_dir: "{{ httpd_server_root }}/conf"
      httpd_confd_dir: "{{ httpd_server_root }}/conf.d"
      httpd_mime_types_dir: "{{ httpd_conf_dir }}/mime.types"
    
    - role: tds-gateway

- hosts: slaves
  vars:
    miniconda_python: 2
    miniconda_prefix: "{{ tomcat_catalina_home }}/miniconda2"
    miniconda_env:
      name: udg
      dependencies:
        - libnetcdf=4.4.1
        - supervisor=3.1.3
  vars_files:
    - secret.yml
    - develDeployment.yaml
    - develCatalogs.yaml
  roles:
    - role: ansible-miniconda-role
    - role: supervisord-conda
      venv_home: "{{ miniconda_prefix }}/envs/{{ miniconda_env.name }}"
    - role: tomcat
      venv_home: "{{ miniconda_prefix }}/envs/{{ miniconda_env.name }}"
