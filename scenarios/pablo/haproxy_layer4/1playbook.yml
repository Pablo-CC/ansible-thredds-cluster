- name: Provision servers
  hosts: servers
  become: True
  tasks:
          - name: Install unzip package
            yum: name=unzip state=present



- name: Provision load-balancer
  hosts: load-balancer
  become: True
  tasks:
          - name: Install net-tools
            yum: name=net-tools state=present


- name: Deploy HAProxy on load balancer
  gather_facts: False
  hosts: load-balancer
  roles:
          - role: haproxy
          
- name: Configure servers with Tomcat
  hosts: servers
  become: True
  vars_files:
          - secret.yml
  vars:
          miniconda_python: 2
          miniconda_prefix: "{{ ansible_env.HOME }}/miniconda2"
          miniconda_env:
                name: udg
                dependencies:
                        - libnetcdf=4.4.1
                        - supervisor
          venv_home: "{{ miniconda_prefix }}/envs/{{ miniconda_env.name }}"
  roles:
          - role: ansible-miniconda-role
          - role: supervisord-conda
          - role: tds


