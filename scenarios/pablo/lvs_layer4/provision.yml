- name: Gather Facts on all hosts
  hosts: all
  gather_facts: True

- name: Provision
  hosts: all
  become: True
  gather_facts: True
  tasks:
    - name: Install EPEL repository
      command: "yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-{{ ansible_distribution_major_version }}.noarch.rpm -y"
      args:
        warn: False
          
    - name: Install software
      yum:
        name:
          - tcpdump
          - iperf3
          - nuttcp
        enablerepo: epel
        state: present


- name: Provision servers
  hosts: servers
  become: True
  tasks:
    - name: Install software
      yum:
        name:
          - net-tools
          - unzip
          - iptables
        state: present

- name: Provision Load Balancer
  hosts: load-balancer
  become: True
  tasks:
    - name: Install software
      yum:
        name:
          - ipvsadm
        state: present
