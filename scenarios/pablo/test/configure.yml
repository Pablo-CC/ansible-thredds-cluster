- name: Gather facts on all hosts
  hosts: all
  become: True

- name: Configure load-balancer
  hosts: load-balancer
  become: True
  roles:
    - ipvsadm
         
- name: Configure servers with iptables
  hosts: servers
  become: True
  roles:
    - iptables
             
- name: Configure servers with Tomcat
  hosts: servers
  become: True
  vars_files:
    - secret.yml

  vars:
    miniconda_python: 2
    miniconda_prefix: "{{ ansible_env.HOME }}/miniconda2"
    miniconda_env:
      name: udg
      dependencies:
        - libnetcdf=4.4.1
        - supervisor
    venv_home: "{{ miniconda_prefix }}/envs/{{ miniconda_env.name }}"
  roles:
    - role: ansible-miniconda-role
    - role: supervisord-conda
    - role: tds
  
