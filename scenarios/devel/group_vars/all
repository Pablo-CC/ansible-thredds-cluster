---
datasets: &hola
  - src: data/datasets
    dest: '' # If empty, path is public/ in THREDDS
    #  - src: /home/zequi/tests/ncml-dataset
    #    dest: ''
    
collections:
  - &collection1
    path: collection1 # Id of the collection and logical path in THREDDS
    top: True # Add a reference in the tds gateway to the collection
    references: ['collection2'] # Have I implemented this?
    mode: '2775'
    catalogs:
      src: data/collection1
      _owner: zequi
    services: [catalog, fileServer, dodsC]

  - &collection2
    path: collection2
    top: True
    catalogs:
      src: data/collection2
    services: [dap4, dodsC, catalog, fileServer, ncss/grid]
    datasets: *hola

tds_instances:
  - &instance1
    name: instance1
    shutdown: 18000
    # tds_content_root: whatever # default "{{ tomcat_base }}/instance1/content" /thredds is hardcoded
    tds_debug:
      jpda_address: "{{ ansible_eth1.ipv4.address }}:8000"
    connectors:
      - protocol: HTTP/1.1
        port: 8080
      - protocol: AJP/1.3
        port: 18009
    manager:
      className: "de.javakaffee.web.msm.MemcachedBackupSessionManager"
      memcachedNodes: "n1:{{ hostvars['hostA'].ansible_eth1.ipv4.address }}:11211"

replicas:
  - &r
    gateway: proxy # ansible host id
    host: "{{ ansible_eth1.ipv4.address }}" # tds_instance IP or hostname
    port: 18009 # tds_instance Connector port
    tds_instance: *instance1 # *instance1 # solo una, por el connector
    collection: *collection1 # *collection1
    route: "{{ ansible_hostname ~ '_' ~ 18009 }}"

  - <<: *r
    collection: *collection2

#  - name: instance2
#    shutdown: 19000
#    tds_debug:
#      jpda_adress: "{{ ansible_eth1.ipv4.address }}:8001"
#    connectors:
#      - protocol: HTTP/1.1
#        port: 9090
#    manager:
#      className: "de.javakaffee.web.msm.MemcachedBackupSessionManager"
#      memcachedNodes: "n1:{{ hostvars['hostA'].ansible_eth1.ipv4.address }}:11211"
#    gateways:
#      - id: proxy
#        host: "{{ ansible_eth1.ipv4.address }}"
#        replicas:
#          - collection2
#        properties:
#          port: 19009
#          protocol: AJP/1.3

tap_instances:
  - name: tap1
    shutdown: 20005
    connectors:
      - protocol: AJP/1.3
        port: 20009
        proxy: proxy
        host: "{{ ansible_eth1.ipv4.address }}"
    lb:
      - name: tap

