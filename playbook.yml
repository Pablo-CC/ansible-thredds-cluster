---
- name: deploy apache and reverse proxy in centos6
  hosts: centos6
  become: true
  become_method: sudo
  vars_files:
    - "{{ansible_distribution}}-{{ansible_distribution_major_version}}.yml"
  roles: 
    - role: apache
    - role: load-balancer
  tags: centos6

- name: deploy apache in centos7
  become: true
  become_method: sudo
  hosts: centos7
  vars_files:
    - "{{ansible_distribution}}-{{ansible_distribution_major_version}}.yml"
  roles:
    - role: apache
  tags: centos7

- name: deploy apache in worker1
  become: true
  become_method: sudo
  hosts: worker1
  vars_files:
    - "{{ansible_distribution}}-{{ansible_distribution_major_version}}.yml"
  roles:
    - role: apache
  tags: work1

- name: deploy apache in worker2
  become: true
  become_method: sudo
  hosts: worker2
  vars_files:
    - "{{ansible_distribution}}-{{ansible_distribution_major_version}}.yml"
  roles:
    - role: apache
  tags: work2

- name: Deploy Java
  hosts: workers
  become: true
  become_method: sudo
  tasks:
    - name: Install Java 1.7
      yum:
        name: java-1.7.0-openjdk
        state: present
  tags: java

- name: deploy 2 TDS instances in Workers
  become: true
  become_method: sudo
  hosts: workers
  vars:
    tomcat_instances:
      - name: foo
        service_name: tomcat@foo
        port_ajp: 18009
        port_connector: 18080
        port_redirect: 18443 
        port_shutdown: 18005
        jvm_route: "{{ inventory_hostname }}1"
      - name: bar
        service_name: tomcat@bar
        port_ajp: 28009
        port_connector: 28080
        port_redirect: 28443
        port_shutdown: 28005
        jvm_route: "{{ inventory_hostname }}2"
  roles:
    - ansible-tomcat
  tags: deploy_tomcat

- name: jk workers
  become: true
  become_method: sudo
  hosts: workers
  vars_files:
    - "{{ansible_distribution}}-{{ansible_distribution_major_version}}.yml"
  roles: 
    - load-balancer
  tags: jk_workers

