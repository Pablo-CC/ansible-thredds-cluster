---
- name: deploy apache and reverse proxy in centos6
  hosts: centos6
  become: true
  become_method: sudo
  vars_files:
    - apache_ports.yml
    - "{{ansible_distribution}}-{{ansible_distribution_major_version}}.yml"
  roles: 
    - role: apache
      httpd_port: "{{ httpd_port_centos6 }}"
    - role: reverse-proxy

- name: deploy apache in centos7
  become: true
  become_method: sudo
  hosts: centos7
  vars_files:
    - apache_ports.yml
    - "{{ansible_distribution}}-{{ansible_distribution_major_version}}.yml"
  roles:
    - role: apache
      httpd_port: "{{ httpd_port_centos7 }}"

- name: deploy apache in worker1
  become: true
  become_method: sudo
  hosts: worker1
  vars_files:
    - apache_ports.yml
    - "{{ansible_distribution}}-{{ansible_distribution_major_version}}.yml"
  roles:
    - role: apache
      httpd_port: "{{ httpd_port_worker1 }}"

- name: deploy apache in worker2
  become: true
  become_method: sudo
  hosts: worker2
  vars_files:
    - apache_ports.yml
    - "{{ansible_distribution}}-{{ansible_distribution_major_version}}.yml"
  roles:
    - role: apache
      httpd_port: "{{ httpd_port_worker2 }}"


- name: Deploy Java
  hosts: workers
  become: true
  become_method: sudo
  tasks:
    - name: Install Java 1.7
      yum:
        name: java-1.7.0-openjdk
        state: present
  tags: java

- name: deploy 2 TDS instances in Workers
  become: true
  become_method: sudo
  hosts: workers
  vars:
    tomcat_instances:
      - name: foo
        service_name: tomcat@foo
        port_ajp: 18009
        port_connector: 18080
        port_redirect: 18443 
        port_shutdown: 18005
      - name: bar
        service_name: tomcat@bar
        port_ajp: 28009
        port_connector: 28080
        port_redirect: 28443
        port_shutdown: 28005
  roles:
    - ansible-tomcat
  tags: deploy_tomcat


